<head>
	<title>Meteorchat</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
	{{>page}}
</body>

<template name="page">

	{{#if currentUser}}
	<aside id="side-menu">
		<h1>Contacts</h1>
		<menu id="contacts" label="contacts" type="list">
			{{>contacts}}
		</menu>
		<h1>Settings</h1>
		<menu id="settings" label="settings" type="list">
			{{> settings}}
		</menu>
	</aside>
	{{#if showEditProfileDialog}}
	{{> editProfileDialog}}
	{{/if}}
	{{#if showAddContactDialog}}
	{{> addContactDialog}}
	{{/if}}
	{{> chat}}
	{{else}}
		<div class="well">{{loginButtons}}</div>

	{{/if}}
</template>


<template name="contacts">
	<li class="item" id="add-contact">
		<a href="#">
			<span>Add contact</span>
		</a>
	</li>
	{{#each contacts}}
		<li class="item">
			<a href="/{{_id}}"><img src="{{gravatar}}?s=40" alt="">
				<span>{{profile.name}}</span>
			</a>
		</li>		
	{{/each}}
</template>

<template name="addContactDialog">
	<div class="modal-backdrop"></div>
	<div class="modal">

		<div class="modal-body">


			<form>
			<fieldset>
				<legend>Add contact</legend>
				{{#if error}}
					<div class="alert alert-error">{{error}}</div>
				{{/if}}
				<label>
					Email address
					<input id="contact-email" type="email" required placeholder="Enter an email addressâ€¦">
				</label>

			</fieldset>

				<button type="button" class="submit btn btn-primary">Add</button>
				<button class="btn cancel" type="button">Cancel</button>
			</form>
		</div>
	</div>
</template>


<template name="settings">
	<li class="item" id="edit-profile" class="item">
		<a href="#">
			<span>Edit profile</span>
		</a>
	</li>
	<li class="item" onclick="Meteor.logout()">
		<a href="#" onclick="Meteor.logout()">
			<span>Logout</span>
		</a>
	</li>

</template>

<template name="editProfileDialog">
	<div class="modal-backdrop">
	</div>
	<div class="modal">
		<div class="modal-body">
			<form>
				<fieldset>
					<legend>Profile settings</legend>
					<label for="gravatar"></label>
					<a class="gravatar" href="https://en.gravatar.com/emails">
						<img class="img-polaroid" src="{{image}}">
					</a>	
					<label for="name">Name</label>
					<input required id="name" type="text" placeholder="{{profile.name}}">
				</fieldset>
				<button type="button" class="submit btn btn-primary">Update</button>
				<button class="btn cancel" type="button">Cancel</button>
			</form>
		</div>
	</div>
</template>

<template name="chat">
	<section id="main">
		<header>
			<h1>{{{he.profile.name}}</h1>
		</header>
		<div id="content">
				<ol id="messages">
					{{#each chat.messages}}
						{{#if isMe sender}}
						<li class="me">
							<article>
								<header>
									<h2>{{me.profile.name}}</h2>
									<time pubtime datetime="{{timestamp}}">{{prettyDate timestamp}}</time>
								</header>
								<p>{{text}}</p>
							</article>
						</li>			
						{{else}}
						<li class="he">
							<article>
								<header>
									<h2>{{he.profile.name}}</h2>
									<time pubtime datetime="{{timestamp}}">{{prettyDate timestamp}}</time>
								</header>
								<p>{{text}}</p>
							</article>
						</li>		
						{{/if}}
					{{/each}}
				</ol>
				<form id="send-message-form">
					<input onkeypress="return event.keyCode!=13" type="text" placeholder="Write message" required>
					<button class="submit btn btn-primary" type="button">Send</button>

				</form>

		</div>
	</section>	
</template>

